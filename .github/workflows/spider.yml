name: ÁîüË¥¢ÊúâÊúØÈ£éÂêëÊ†áÁà¨Ëô´ - ServerÈÖ±Áâà

on:
  schedule:
      # ÊØèÂ§©Âåó‰∫¨Êó∂Èó¥ 9:00 Âíå 18:00 ÊâßË°å (UTCÊó∂Èó¥ 1:00 Âíå 10:00)
          - cron: '0 1 * * *'
              - cron: '0 10 * * *'
                workflow_dispatch:  # ÂÖÅËÆ∏ÊâãÂä®Ëß¶Âèë

                jobs:
                  spider:
                      runs-on: ubuntu-latest

                              steps:
                                  - name: Ê£ÄÂá∫‰ª£Á†Å
                                        uses: actions/checkout@v3

                                                  - name: ËÆæÁΩÆPythonÁéØÂ¢É
                                                        uses: actions/setup-python@v4
                                                              with:
                                                                      python-version: '3.9'

                                                                                  - name: ÁºìÂ≠òPython‰æùËµñ
                                                                                        uses: actions/cache@v3
                                                                                              with:
                                                                                                      path: ~/.cache/pip
                                                                                                              key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
                                                                                                                      restore-keys: |
                                                                                                                                ${{ runner.os }}-pip-
                                                                                                                                        
                                                                                                                                            - name: ÂÆâË£Ö‰æùËµñ
                                                                                                                                                  run: |
                                                                                                                                                          python -m pip install --upgrade pip
                                                                                                                                                                  pip install -r requirements.txt
                                                                                                                                                                          
                                                                                                                                                                              - name: ÂàõÂª∫Êó•ÂøóÁõÆÂΩï
                                                                                                                                                                                    run: mkdir -p logs
                                                                                                                                                                                          
                                                                                                                                                                                              - name: ËøêË°åÁà¨Ëô´
                                                                                                                                                                                                    env:
                                                                                                                                                                                                            SERVER_CHAN_KEY: ${{ secrets.SERVER_CHAN_KEY }}
                                                                                                                                                                                                                  run: |
                                                                                                                                                                                                                          echo "üöÄ ÂºÄÂßãÊâßË°åÁîüË¥¢ÊúâÊúØÈ£éÂêëÊ†áÁà¨Ëô´‰ªªÂä°"
                                                                                                                                                                                                                                  echo "‚è∞ ÊâßË°åÊó∂Èó¥: $(date '+%Y-%m-%d %H:%M:%S')"
                                                                                                                                                                                                                                          echo "üîß PythonÁâàÊú¨: $(python --version)"
                                                                                                                                                                                                                                                  echo "üì¶ ‰æùËµñÂåÖ‰ø°ÊÅØ:"
                                                                                                                                                                                                                                                          pip list
                                                                                                                                                                                                                                                                  echo ""
                                                                                                                                                                                                                                                                          echo "üï∑Ô∏è ÂêØÂä®Áà¨Ëô´..."
                                                                                                                                                                                                                                                                                  python spider.py
                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                              - name: ‰∏ä‰º†Êó•ÂøóÊñá‰ª∂
                                                                                                                                                                                                                                                                                                    if: always()
                                                                                                                                                                                                                                                                                                          uses: actions/upload-artifact@v3
                                                                                                                                                                                                                                                                                                                with:
                                                                                                                                                                                                                                                                                                                        name: spider-logs-${{ github.run_number }}
                                                                                                                                                                                                                                                                                                                                path: |
                                                                                                                                                                                                                                                                                                                                          *.log
                                                                                                                                                                                                                                                                                                                                                    sent_posts.db
                                                                                                                                                                                                                                                                                                                                                            retention-days: 7
                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                        - name: Ê£ÄÊü•ÊâßË°åÁªìÊûú
                                                                                                                                                                                                                                                                                                                                                                              if: always()
                                                                                                                                                                                                                                                                                                                                                                                    run: |
                                                                                                                                                                                                                                                                                                                                                                                            echo "üìä ÊâßË°åÁªìÊûúÁªüËÆ°:"
                                                                                                                                                                                                                                                                                                                                                                                                    if [ -f spider.log ]; then
                                                                                                                                                                                                                                                                                                                                                                                                              echo "üìÑ Êó•ÂøóÊñá‰ª∂Â§ßÂ∞è: $(du -h spider.log | cut -f1)"
                                                                                                                                                                                                                                                                                                                                                                                                                        echo "üìà Êó•ÂøóÊù°Êï∞: $(wc -l spider.log | cut -d' ' -f1)"
                                                                                                                                                                                                                                                                                                                                                                                                                                  echo ""
                                                                                                                                                                                                                                                                                                                                                                                                                                            echo "üîç ÊúÄËøë10Êù°Êó•Âøó:"
                                                                                                                                                                                                                                                                                                                                                                                                                                                      tail -10 spider.log
                                                                                                                                                                                                                                                                                                                                                                                                                                                              else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        echo "‚ö†Ô∏è Êú™ÊâæÂà∞Êó•ÂøóÊñá‰ª∂"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                fi
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if [ -f sent_posts.db ]; then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          echo "üíæ Êï∞ÊçÆÂ∫ìÊñá‰ª∂Â§ßÂ∞è: $(du -h sent_posts.db | cut -f1)"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            echo "‚ö†Ô∏è Êú™ÊâæÂà∞Êï∞ÊçÆÂ∫ìÊñá‰ª∂"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    fi
